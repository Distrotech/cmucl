#!/bin/csh -f
#
#  mk-lisp -- script for building full lisp cores.
#
# $Header: /Volumes/share2/src/cmucl/cvs2git/cvsroot/src/tools/Attic/mk-lisp,v 1.5 1991/06/05 14:05:45 ram Exp $

if ($#argv) then
	set subdir = $argv[1]
	set features = ($argv[2-])
else
	set subdir = alpha
	set features = ()
endif

set lisp = /afs/cs/project/clisp/new-compiler/@sys/$subdir

if (-e $lisp/ldb/kernel.core) then
	set core = $lisp/ldb/kernel.core
else
	if (-e /usr/tmp/kernel.core) then
		set core = /usr/tmp/kernel.core
	else
		echo 'Can\'t find the kernel.core'
	endif
endif

if (-e $lisp/VERSION) then
	set version = `cat $lisp/VERSION`
else
	set version = `/bin/date | awk '{print $2 "-" $3 "-" $6}'`
endif

# set a bunch of random env vars to fill up space.
setenv FOO XXXXXXXXXXXXXXXX
setenv FOO $FOO$FOO$FOO$FOO
setenv FOO $FOO$FOO$FOO$FOO
setenv BAR $FOO
setenv BAZ $FOO
setenv ACK $FOO
setenv RAZ $FOO
setenv GORP $FOO

echo Building lisp.core dated $version from the \`\`$subdir\'\' subdir.

$lisp/ldb/ldb -core $core << EOF
(setf *features* (append '($features) *features*))
(setf (search-list "lisp:") '("$lisp/"))
(in-package "USER")
(load (open "lisp:tools/worldload.lisp"))
$version
(quit)
EOF

echo 
